os: linux
dist: bionic
language: python
python:
  - 3.8
services:
  - docker
script:
  - pip3 install --upgrade setuptools pytest pytest-cov freezegun
  - pip3 install --upgrade --no-cache-dir --editable .
  - BRANCH=$([  -z "$TRAVIS_PULL_REQUEST_BRANCH" ] && echo "$TRAVIS_BRANCH" || echo "$TRAVIS_PULL_REQUEST_BRANCH")
  # - git clone -b ${BRANCH} --depth=1 https://github.com/rapydo/tests.git rapydo_tests
  - mkdir rapydo_tests
  - cd rapydo_tests
  - mkdir -p data/logs
  - export LOGURU_LEVEL=DEBUG
  - py.test -s -x --cov-report=xml --cov=controller ../tests || travis_terminate 1;
  - bash <(curl -s https://codecov.io/bash) -y codecov.yml -R ../

jobs:
  include:
    - stage: test
      python: 3.5
      dist: bionic
      env:
        - UBUNTU_VER=18.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.6
      dist: bionic
      env:
        - UBUNTU_VER=18.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.7
      dist: bionic
      env:
        - UBUNTU_VER=18.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.8
      dist: bionic
      env:
        - UBUNTU_VER=18.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.5
      dist: xenial
      env:
        - UBUNTU_VER=16.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.6
      dist: xenial
      env:
        - UBUNTU_VER=16.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.7
      dist: xenial
      env:
        - UBUNTU_VER=16.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.8
      dist: xenial
      env:
        - UBUNTU_VER=16.04 # only used as utility from the web interface, since the dist is not reported

    - python: 3.6
      dist: trusty
      env:
        - UBUNTU_VER=14.04 # only used as utility from the web interface, since the dist is not reported
  # - python: 3.6
  #   os: osx
  #   language: sh  # 'language: python' is an error on Travis CI macOS
  #   before_install:
  #     - brew update
  #     - brew upgrade python3
  #     - python3 -m pip install virtualenv
  #     - virtualenv .venv -p python3
  #     - source .venv/bin/activate
  #     - curl -fsSL https://get.docker.com -o get-docker.sh
  #     - sh get-docker.sh
  # - python: 3.7
  #   os: osx
  #   language: sh  # 'language: python' is an error on Travis CI macOS
  #   before_install:
  #     - brew update
  #     - brew upgrade python3
  #     - python3 -m pip install virtualenv
  #     - virtualenv .venv -p python3
  #     - source .venv/bin/activate
  #     - curl -fsSL https://get.docker.com -o get-docker.sh
  #     - sh get-docker.sh
  # - python: 3.8
  #   os: osx
  #   language: sh  # 'language: python' is an error on Travis CI macOS
  #   before_install:
  #     - brew update
  #     - brew upgrade python3
  #     - python3 -m pip install virtualenv
  #     - virtualenv .venv -p python3
  #     - source .venv/bin/activate
  #     - curl -fsSL https://get.docker.com -o get-docker.sh
  #     - sh get-docker.sh
  # Travis error:
  # ERROR: for XYZ image operating system "linux" cannot be used on this platform
  # - os: windows
  #   language: sh # The language 'python' is currently unsupported on the Windows Build Environment.
  #   python: "3.x"
  #   before_install:
  #     - choco install python3 --params "/InstallDir:C:\\Python"
  #     - export PATH="/c/Python:/c/Python/Scripts:$PATH"
  #     - python -m pip install --upgrade pip wheel

notifications:
  email: false
  slack:
    rooms:
      secure: VBkLxMwcNSpYQeg5LUyLz5O28Eq/KztevWZP04vdT5qFyKXo7xbygGaxgHcE8mG3TCmdsbyW7B3Pjc+63G2FlCKK+4icHrsEiP9BFRychD2CrpxhjgbEOArkMRbuN1FetDucUhq5ac8oMJpVXvHvN4jLZrk5GrH+SYL2co6yvWILujUpT5XoKF0/Hh5m8Xa+eYs0vH45on6vlwOz0Opv7n3itgrEVCklQzghVYpNuUiRn8RE98afeV3ePvs3TOmws3ZtjWMeqbB43au4iPe926sxj6OAoKXFVpRqozyQRCI1FPlMt+2c4jbrwl0ZqWqI/6TbSVU9lplPopkwYSK8RcwMelTP4XX4wxZK410+7rmgkNoCcB/lFCFd0ytmFcgS1fPfCM8zS9FCJeBfqvjUynCxzss2MuFu95pmCDtPrwapefUViJlHih6roWY+EPRJD2NftNeWO/xeVrOSoNqhaqL2tFhBiIbmJuMlhL+CKle1UP8IeBEa215AMyq+VGYigOvTTscn+zkDj0857RC/oyf8sPTtRk1qnic1Ajd4Uqs0qSUlyIAdlSu8YNN5hyUQIJA8hogZZlvXV90gj5w8XBH1VbaecBLcwdyJZQ4hQ+7vhE/UxiQWmqlYlgdGbAIRniRFZm12i6MrDEK8EMVH7SImDc8ZTGuGbNY/Tcgfw8Q=
    on_success: change # default: always
    on_failure: always # default: always
