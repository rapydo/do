
description: Do actions with your RAPyDo project
action:
  name: action
  help: all possible commands

options:

  project:
    alias: p
    # NOTE: this is the equivalent of the old concept of `blueprint`
    type: str
    metavalue: PROJECT_NAME
    help: name of the project to be found inside the './projects' directory
    #Â The only one if exists otherwise list the projects.
    default: null

  # deprecated since 0.7.1
  mode:
    alias: m
    type: str
    metavalue: CONTAINERS_YAML_SELECTED_MODE
    default: null
    help: mode is like a 'blueprint' marker of the configuration to launch - DEPRECATED! user --stack instead

  stack:
    type: str
    metavalue: CONTAINERS_YAML_STACK
    default: null
    help: the docker-compose stack to be loaded (from the projects conf folder)

  # deprecated since 0.7.0
  log-level:
    alias: l
    type: str
    metavalue: LEVEL_OF_DEBUGGER
    default: DEPRECATED
    help: level of verbosity - DEPRECATED! export LOGURU_LEVEL env variable instead

  no-backend:
    type: bool
    default: False
    help: Exclude backend configuration from rapydo stack

  no-frontend:
    type: bool
    default: False
    help: Exclude frontend configuration from rapydo stack

  no-commons:
    type: bool
    default: False
    help: Exclude project common configuration from rapydo stack

  # collect-logs:
  #   type: bool
  #   default: False
  #   help: Collect logs from containers on ELK pipeline - NO LONGER WORKING

  hostname:
    alias: H
    type: str
    metavalue: MACHINE_HOST_NAME
    default: localhost
    help: "host name of the current machine where the server is running"

  services:
    alias: s
    type: str
    metavalue: SERVICES_COMMA_SEPARATED
    default: active services
    help: list of services referring to a command

  # deprecated since 0.7.0
  development:
    type: bool
    default: False
    help: switch to development mode - DEPRECATED!

  privileged:
    type: bool
    default: False
    help: allow containers to start in privileged mode

  check-permissions:
    type: bool
    default: False
    help: Enabled permission checks on file system

  production:
    alias: -prod
    type: bool
    default: False
    help: enable production mode

  # net:
  #   type: str
  #   default: bridge
  #   help: change the docker network used

subcommands:

  dump:
    description: dump current config into docker compose YAML

  formatter:
    description: "run 'black' formatter on main project backend code"
    suboptions:
      folder:
        alias: f
        type: str
        metavalue: FOLDER_NAME
        default: apis
        help: name of folder to be formatted
      submodule:
        alias: s
        type: str
        metavalue: SUBMODULE_NAME
        default: vanilla
        help: name of submodule to be formatted. Project folder is defined as vanilla submodule

  check:
    description: "only verify if currently compliant to RAPyDo specs
        (NOTE: this is done at every call)"
    suboptions:
      ignore-submodule:
        alias: i
        type: str
        metavalue: IGNORE_SUBMODULE
        # default: 'upstream'
        help: ignore a given list of submodules (command delimited)
      no-git:
        alias: s
        type: bool
        default: False
        help: ignore the heaviest check operations on git commits
      no-builds:
        type: bool
        default: False
        help: ignore the heaviest builds operations
  init:
    description: "
      make current project compliant to RAPyDo requirements
      (if not yet being)"
    suboptions:
      submodules-path:
        type: str
        metavalue: SUBMODULE_PATH
        help: link all submodules in an existing folder instead of download them
  update:
    description: update the current project
    suboptions:
      ignore-submodule:
        alias: i
        type: str
        metavalue: IGNORE_SUBMODULE
        help: ignore a given list of submodules (command delimited)
      rebuild:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: rebuild templates if required

  install:
    description: Install a rapydo-controller version
    suboptions:
      version:
        help: version number or auto to automatically detect required version
        positional: true
        type: str
        metavalue: VERSION
        default: auto
      pip:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: install from pypi
      editable:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: install in editable mode from submodules folder
      user:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: install at user level (sudo not required)

  status:
    description: list current status of containers
  build:
    description: force building of one or more services docker images
    suboptions:
      rebuild-templates:
        alias: t
        type: bool
        # metavalue: TRUE_OR_FALSE
        default: False
        help: force rebuild of parent images (templates) used in local builds
      force:
        alias: f
        type: bool
        # metavalue: TRUE_OR_FALSE
        default: False
        help: remove the build cache to force the complete rebuilding
  pull:
    description: pull available images from docker hub
  logs:
    description: watch log tails of all or specified containers
    suboptions:
      follow:
        alias: f
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: follow logs
      tail:
        alias: t
        type: str
        metavalue: INTEGER_NUM_LINES
        default: "1000"
        help: logs
      service:
        alias: s
        type: str
        metavalue: SERVICE
        default: null
  custom:
    description: execute predefined custom commands inside containers
  ssl-certificate:
    description: issue a production certificate with service Letsencrypt
    container_exec:
      name: letsencrypt
      command: /bin/bash updatecertificates
      service: proxy
      user: root
    suboptions:
      chain-file:
        type: str
        metavalue: PATH_TO_CHAIN_FILE
        default: null
        help: path to existing chain file (.pem format)
      key-file:
        type: str
        metavalue: PATH_TO_KEY_FILE
        default: null
        help: path to existing key file (.pem format)
      volatile:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Create a volatile proxy service to request the certificate
      force:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Force Let's Encrypt to renew the certificate
      no-tty:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Disable pseudo-tty allocation, useful to execute the command from a cronjob
  ssl-dhparam:
    description: "generate DH DSA parameters, 4096 bit long prime. BEWARE: this may take very long time to complete"
    container_exec:
      name: dhparam
      command: openssl dhparam -out /etc/nginx/ssl/dhparam.pem 4096
      service: proxy
      user: root
  interfaces:
    description: run off some predefined interfaces to services
    suboptions:
      service:
        positional: true
        type: str
        metavalue: SERVICE
        default: null
      port:
        alias: p
        type: int
        metavalue: INTEGER_PORT_FOR_SERVICE
        default: null
        help: port to be associated to the current service interface
      detach:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Detached mode to run the container in background

  shell:
    description: open a shell inside one available 'dockerized' service
    suboptions:
      service:
        positional: true
        type: str
        metavalue: SERVICE
        default: null
      user:
        alias: u
        type: str
        metavalue: UNIX_EXISTING_USER
        default: ''
        help: user existing inside selected service
      command:
        alias: c
        type: str
        metavalue: TERMINAL_COMMAND_UNIX-LIKE
        help: UNIX command to be executed on selected running service
      default-command:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Execute the default command configured for the container. Not compatible with --command and not implemented for all containers
      no-tty:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Disable pseudo-tty allocation, useful to execute the command from non interactive script
  start:
    description: Start containers for this configuration
    suboptions:
      no-detach:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: Disable detach mode and attach to container execution
  stop:
    description: stop running containers, but do not remove them
  restart:
    description: restart running containers
  remove:
    description: stop containers (if running) and also remove them
  toggle-freeze:
    description: toggle a temporary block/pause on running containers
  clean:
    description: "remove all:
      containers, networks and OPTIONALLY data volumes"
    suboptions:
      rm-volumes:
      # remove-all-volumes:
        alias: rm
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: remove also containers persistent data
  list:
    description: print rapydo configurations
    suboptions:
      args:
        alias: a
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: List of configured rapydo arguments
      env:
        alias: e
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: List environment variable (.env file)
      services:
        alias: s
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: List running services
      submodules:
        alias: m
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: List submodules
  scale:
    description: scale the number of containers for one service
    suboptions:
      value:
        positional: yes
        type: str
        metavalue: "SERVICE=NUM_REPLICA"
        default:
        help: scale SERVICE to NUM_REPLICA
  find:
    description: show information about an existing endpoint
    suboptions:
      endpoint:
        positional: no
        type: str
        metavalue: ENDPOINT_NAME
        help: an existing endpoint name to search inside the swagger definition
  template:
    description: create a new endpoint based on a template
    suboptions:
      endpoint:
        positional: yes  # note: yes is equivalent to True in YAML
        type: str
        metavalue: ENDPOINT_NAME
        default: foo
        help: the endpoint name to be created
      'yes':
        alias: y
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: say yes to all questions
      service:
        alias: s
        type: str
        metavalue: CONNECTED_SERVICE
        # default: sqlalchemy
        help: the first service that will be connected inside the code
  verify:
    description: check a service connection within the backend container
    suboptions:
      service:
        positional: yes
        type: str
        metavalue: SERVICE
        default: null
  volatile:
    description: one command container
    suboptions:
      service:
        positional: yes
        type: str
        metavalue: SERVICE
        default: null
      command:
        positional: no
        # alias: c
        type: str
        metavalue: TERMINAL_COMMAND_UNIX-LIKE
        default: bash
        help: UNIX command to be executed
  create:
    description: create a new rapydo project
    suboptions:
      template:
        positional: true
        type: str
        metavalue: TEMPLATE_NAME
        default: null
        help: Name of the template used to initialize your project. Allowed values are sql, neo, mongo, celerytest, irodstest, centos 
      name:
        positional: true
        type: str
        metavalue: NAME
        default: null
        help: Name of your new project
  ancestors:
    description: find all ancestors of a docker image
    suboptions:
      imagetag:
        positional: true
        type: str
        metavalue: IMAGE_TAG_ID
        default: null
        help: Image tag ID to be inspected

  version:
    description: Retrieve version details

