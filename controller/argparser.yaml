
description: Do actions with your RAPyDo project
action:
  name: action
  help: all possible commands

options:

  # TODO: add the --env option (or --print-env) for all commands
  # env:
  #   alias: e
  #   help: print the variables to be used with the command and exit

  project:
    alias: p
    # NOTE: this is the equivalent of the old concept of `blueprint`
    type: str
    metavalue: PROJECT_NAME
    help: name of the project to be found inside the './projects' directory
    # The only one if exists otherwise list the projects.
    default: null

  mode:
    alias: m
    type: str
    metavalue: CONTAINERS_YAML_SELECTED_MODE
    default: debug
    help: mode is like a 'blueprint' marker of the configuration to launch

  log-level:
    alias: l
    type: str
    metavalue: LEVEL_OF_DEBUGGER
    default: DEBUG
    help: level of verbosity

  collect-logs:
    type: bool
    default: False
    help: Collect logs from containers on ELK pipeline

  hostname:
    alias: H
    type: str
    metavalue: MACHINE_HOST_NAME
    default: localhost
    help: "host name of the current machine where the server is running
        (NOTE: only used in production mode)"

  services:
    alias: s
    type: str
    metavalue: SERVICES_COMMA_SEPARATED
    default: active services
    help: list of services referring to a command

  # force-env:
  cache-env:
    alias: env
    type: bool
    default: False
    # help: Force recreation of the docker compose .env file even if existing
    help: cache the docker compose .env file instead of recreating it

  development:
    type: bool
    default: False
    help: switch to development mode

  privileged:
    type: bool
    default: False
    help: allow containers to start in privileged mode

subcommands:
  check:
    description: "only verify if currently compliant to RAPyDo specs
        (NOTE: this is done at every call)"
    suboptions:
      ignore-submodule:
        alias: i
        type: str
        metavalue: IGNORE_SUBMODULE
        default: 'upstream'
        help: ignore a given list of submodules (command delimited)
      skip-heavy-git-ops:
        alias: s
        type: bool
        default: False
        help: ignore the heaviest check operations on git commits
      verify-upstream:
        alias: u
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: include upstream repo (rapydo-core) to checked submodules
      skip-bower:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: skip update of bower libs
  init:
    description: "
      make current project compliant to RAPyDo requirements
      (if not yet being)"
    suboptions:
      skip-bower:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: skip update of bower libs
  update:
    description: update the current project
    suboptions:
      ignore-submodule:
        alias: i
        type: str
        metavalue: IGNORE_SUBMODULE
        default: 'upstream'
        help: ignore a given list of submodules (command delimited)
      skip-bower:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: skip update of bower libs
      rebuild:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: rebuild templates if required

  status:
    description: list current status of containers
  build:
    description: force building of one or more services docker images
    suboptions:
      rebuild-templates:
        alias: r
        type: bool
        # metavalue: TRUE_OR_FALSE
        default: False
        help: force building of templates docker images used in other builds
      force:
        alias: f
        type: bool
        # metavalue: TRUE_OR_FALSE
        default: False
        help: remove caches of previous builds on this service
  log:
    description: watch log tails of all or specified containers
    suboptions:
      follow:
        alias: f
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: tail logs
  custom:
    description: execute predefined custom commands inside containers
  ssl-certificate:
    description: issue a production certificate with service Letsencrypt
    container_exec:
      name: letsencrypt
      command: /bin/bash updatecertificates
      service: proxy
      user: root
  ssl-dhparam:
    description: "generate DH DSA parameters, 4096 bit long prime. BEWARE: this may take very long time to complete"
    container_exec:
      name: dhparam
      command: openssl dhparam -out /etc/nginx/ssl/dhparam.pem 4096
      service: proxy
      user: root
  bower-install:
    description: install a new front-end library with bower
    container_exec:
      name: bower
      # command: bower install
      service: bower
      user: develop
    suboptions:
      lib:
        alias: l
        type: str
        metavalue: BOWER_LIB_TO_INSTALL
        default: null
        help: the bower library to be installed
  bower-update:
    description: update a front-end library with bower
    container_exec:
      name: bower
      # command: bower update
      service: bower
      user: develop
    suboptions:
      lib:
        alias: l
        type: str
        metavalue: BOWER_LIB_TO_INSTALL
        default: null
        help: the bower library to be installed
  interfaces:
    description: run off some predefined interfaces to services
    suboptions:
      service:
        positional: true
        type: str
        metavalue: SERVICE
        default: null
      port:
        alias: p
        type: int
        metavalue: INTEGER_PORT_FOR_SERVICE
        default: null
        help: port to be associated to the current service interface
  shell:
    description: open a shell inside one available 'dockerized' service
    suboptions:
      service:
        positional: true
        type: str
        metavalue: SERVICE
        default: null
      user:
        alias: u
        type: str
        metavalue: UNIX_EXISTING_USER
        default: ''
        help: user existing inside selected service
      command:
        alias: c
        type: str
        metavalue: TERMINAL_COMMAND_UNIX-LIKE
        default: bash
        help: UNIX command to be executed on selected running service
  start:
    description: Start containers for this configuration
    suboptions:
      from-upgrade:
        alias: fu
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: rebuild images and use them to restart existing containers
  stop:
    description: stop running containers, but do not remove them
  restart:
    description: restart running containers
  remove:
    description: stop containers (if running) and also remove them
  toggle-freeze:
    description: toggle a temporary block/pause on running containers
  clean:
    description: "remove all:
      containers, networks and OPTIONALLY data volumes"
    suboptions:
      rm-volumes:
      # remove-all-volumes:
        alias: rm
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: remove also containers persistent data
  env:
    description: print all configured variables
  find:
    description: show information about an existing endpoint
    suboptions:
      endpoint:
        positional: no
        type: str
        metavalue: ENDPOINT_NAME
        help: an existing endpoint name to search inside the swagger definition
  template:
    description: create a new endpoint based on a template
    suboptions:
      endpoint:
        positional: yes  # note: yes is equivalent to True in YAML
        type: str
        metavalue: ENDPOINT_NAME
        default: foo
        help: the endpoint name to be created
      'yes':
        alias: y
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: say yes to all questions
      service:
        alias: s
        type: str
        metavalue: CONNECTED_SERVICE
        default: sqlalchemy
        help: the first service that will be connected inside the code
  coverall:
    description: send coverage computed to coveralls.io website
  upgrade:
    description: upgrade your current project to new official releases
    suboptions:
      release:
        type: str
        metavalue: RELEASE_VERSION
        help: release version you want to upgrade to
      downgrade:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: allow downgrade to previous versions
      current:
        type: bool
        metavalue: TRUE_OR_FALSE
        default: False
        help: upgrade to current branch. Incompatible with release option

  # tutorial:
  #   description: Step-by-step guide to make your project RAPyDo compliant
  # TODO: a tutorial mode to improve the project step by step
  # instead of all at once like init
